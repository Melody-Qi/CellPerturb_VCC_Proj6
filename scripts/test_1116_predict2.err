INFO:state._cli._tx._predict:Loaded config from checkpoints/first_run/config.yaml
INFO:cell_load.data_modules.perturbation_dataloader:Loaded data module configuration from ./checkpoints/first_run/data_module.torch
WARNING:cell_load.config:Dataset path does not exist: competition_support_set/{competition_train,k562_gwps,rpe1,jurkat,k562,hepg2}.h5
INFO:cell_load.config:Configuration validation passed
INFO:cell_load.data_modules.perturbation_dataloader:Initializing DataModule: batch_size=16, workers=8, random_seed=42
INFO:cell_load.data_modules.perturbation_dataloader:Set 2 missing perturbations to zero vectors.
INFO:cell_load.data_modules.perturbation_dataloader:Loaded custom perturbation featurizations for 19792 perturbations.
INFO:cell_load.data_modules.perturbation_dataloader:Processing dataset replogle_h1:
INFO:cell_load.data_modules.perturbation_dataloader:  - Training dataset: True
INFO:cell_load.data_modules.perturbation_dataloader:  - Zeroshot cell types: ['hepg2']
INFO:cell_load.data_modules.perturbation_dataloader:  - Fewshot cell types: []
Processing replogle_h1:   0%|          | 0/6 [00:00<?, ?it/s]                                                             Processing replogle_h1:   0%|          | 0/6 [00:00<?, ?it/s]Processing replogle_h1:  17%|█▋        | 1/6 [00:00<00:02,  2.45it/s]WARNING:cell_load.dataset._perturbation:No cell barcode information found in competition_support_set/k562_gwps.h5. Generating generic barcodes.
                                                                     Processing replogle_h1:  17%|█▋        | 1/6 [00:00<00:02,  2.45it/s]Processing replogle_h1:  33%|███▎      | 2/6 [00:00<00:00,  4.21it/s]WARNING:cell_load.dataset._perturbation:No cell barcode information found in competition_support_set/rpe1.h5. Generating generic barcodes.
                                                                     Processing replogle_h1:  33%|███▎      | 2/6 [00:00<00:00,  4.21it/s]WARNING:cell_load.dataset._perturbation:No cell barcode information found in competition_support_set/jurkat.h5. Generating generic barcodes.
                                                                     Processing replogle_h1:  33%|███▎      | 2/6 [00:00<00:00,  4.21it/s]WARNING:cell_load.dataset._perturbation:No cell barcode information found in competition_support_set/k562.h5. Generating generic barcodes.
                                                                     Processing replogle_h1:  33%|███▎      | 2/6 [00:00<00:00,  4.21it/s]Processing replogle_h1:  83%|████████▎ | 5/6 [00:00<00:00, 10.21it/s]WARNING:cell_load.dataset._perturbation:No cell barcode information found in competition_support_set/hepg2.h5. Generating generic barcodes.
                                                                     Processing replogle_h1:  83%|████████▎ | 5/6 [00:00<00:00, 10.21it/s]Processing replogle_h1: 100%|██████████| 6/6 [00:00<00:00,  8.86it/s]
INFO:cell_load.data_modules.perturbation_dataloader:

INFO:cell_load.data_modules.perturbation_dataloader:Done! Train / Val / Test splits: 6 / 0 / 1
INFO:state._cli._tx._predict:Loaded data module from ./checkpoints/first_run/data_module.torch
[rank: 0] Seed set to 42
INFO:state._cli._tx._predict:Loading model from ./checkpoints/first_run/checkpoints/last.ckpt
INFO:state._cli._tx._predict:Model loaded successfully.
INFO:cell_load.data_modules.samplers:Creating perturbation batch sampler with metadata caching (using codes)...
INFO:cell_load.data_modules.samplers:Total # cells 9386. Cell set size mean / std before resampling: 78.22 / 47.32.
INFO:cell_load.data_modules.samplers:Creating meta-batches with cell_sentence_len=128...
INFO:cell_load.data_modules.samplers:Of all batches, 120 were full and 0 were partial.
INFO:cell_load.data_modules.samplers:Sampler created with 120 batches in 0.00 seconds.
INFO:state._cli._tx._predict:Generating predictions on test set using manual loop...
Predicting:   0%|          | 0/120 [00:00<?, ?batch/s]INFO:cell_load.data_modules.samplers:Of all batches, 120 were full and 0 were partial.
Predicting:   1%|          | 1/120 [00:04<09:28,  4.77s/batch]Predicting:   3%|▎         | 4/120 [00:05<02:01,  1.05s/batch]Predicting:   4%|▍         | 5/120 [00:05<01:36,  1.19batch/s]Predicting:   6%|▌         | 7/120 [00:05<00:59,  1.91batch/s]Predicting:   8%|▊         | 9/120 [00:06<00:41,  2.68batch/s]Predicting:   9%|▉         | 11/120 [00:06<00:34,  3.20batch/s]Predicting:  10%|█         | 12/120 [00:06<00:34,  3.17batch/s]Predicting:  11%|█         | 13/120 [00:07<00:33,  3.21batch/s]Predicting:  12%|█▏        | 14/120 [00:07<00:32,  3.25batch/s]Predicting:  12%|█▎        | 15/120 [00:07<00:29,  3.61batch/s]Predicting:  13%|█▎        | 16/120 [00:07<00:29,  3.51batch/s]Predicting:  14%|█▍        | 17/120 [00:08<00:26,  3.87batch/s]Predicting:  15%|█▌        | 18/120 [00:08<00:28,  3.56batch/s]Predicting:  16%|█▌        | 19/120 [00:08<00:30,  3.31batch/s]Predicting:  17%|█▋        | 20/120 [00:09<00:30,  3.32batch/s]Predicting:  18%|█▊        | 21/120 [00:09<00:24,  4.01batch/s]Predicting:  18%|█▊        | 22/120 [00:09<00:26,  3.65batch/s]Predicting:  20%|██        | 24/120 [00:09<00:18,  5.18batch/s]Predicting:  22%|██▎       | 27/120 [00:10<00:20,  4.45batch/s]Predicting:  23%|██▎       | 28/120 [00:10<00:20,  4.46batch/s]Predicting:  24%|██▍       | 29/120 [00:11<00:22,  4.09batch/s]Predicting:  26%|██▌       | 31/120 [00:11<00:18,  4.71batch/s]Predicting:  28%|██▊       | 33/120 [00:11<00:17,  5.09batch/s]Predicting:  28%|██▊       | 34/120 [00:11<00:15,  5.55batch/s]Predicting:  29%|██▉       | 35/120 [00:12<00:17,  4.73batch/s]Predicting:  30%|███       | 36/120 [00:12<00:20,  4.19batch/s]Predicting:  31%|███       | 37/120 [00:12<00:20,  4.04batch/s]Predicting:  32%|███▏      | 38/120 [00:13<00:21,  3.73batch/s]Predicting:  33%|███▎      | 40/120 [00:13<00:14,  5.43batch/s]Predicting:  34%|███▍      | 41/120 [00:13<00:17,  4.59batch/s]Predicting:  35%|███▌      | 42/120 [00:13<00:18,  4.13batch/s]Predicting:  36%|███▌      | 43/120 [00:14<00:17,  4.48batch/s]Predicting:  37%|███▋      | 44/120 [00:14<00:18,  4.08batch/s]Predicting:  38%|███▊      | 45/120 [00:14<00:19,  3.79batch/s]Predicting:  39%|███▉      | 47/120 [00:14<00:12,  5.81batch/s]Predicting:  41%|████      | 49/120 [00:15<00:10,  6.84batch/s]Predicting:  42%|████▏     | 50/120 [00:15<00:10,  6.89batch/s]Predicting:  42%|████▎     | 51/120 [00:15<00:09,  7.07batch/s]Predicting:  43%|████▎     | 52/120 [00:15<00:13,  5.11batch/s]Predicting:  44%|████▍     | 53/120 [00:15<00:12,  5.48batch/s]Predicting:  45%|████▌     | 54/120 [00:16<00:14,  4.55batch/s]Predicting:  46%|████▌     | 55/120 [00:16<00:22,  2.91batch/s]Predicting:  47%|████▋     | 56/120 [00:17<00:21,  2.97batch/s]Predicting:  48%|████▊     | 57/120 [00:17<00:20,  3.04batch/s]Predicting:  48%|████▊     | 58/120 [00:17<00:20,  3.10batch/s]Predicting:  49%|████▉     | 59/120 [00:17<00:16,  3.77batch/s]Predicting:  50%|█████     | 60/120 [00:17<00:13,  4.59batch/s]Predicting:  52%|█████▏    | 62/120 [00:18<00:13,  4.43batch/s]Predicting:  53%|█████▎    | 64/120 [00:18<00:09,  6.03batch/s]Predicting:  54%|█████▍    | 65/120 [00:18<00:11,  4.81batch/s]Predicting:  55%|█████▌    | 66/120 [00:19<00:12,  4.25batch/s]Predicting:  56%|█████▌    | 67/120 [00:19<00:13,  3.97batch/s]Predicting:  57%|█████▊    | 69/120 [00:19<00:11,  4.31batch/s]Predicting:  59%|█████▉    | 71/120 [00:20<00:09,  5.28batch/s]Predicting:  61%|██████    | 73/120 [00:20<00:08,  5.27batch/s]Predicting:  62%|██████▏   | 74/120 [00:20<00:10,  4.46batch/s]Predicting:  62%|██████▎   | 75/120 [00:21<00:10,  4.12batch/s]Predicting:  63%|██████▎   | 76/120 [00:21<00:09,  4.46batch/s]Predicting:  64%|██████▍   | 77/120 [00:21<00:10,  3.92batch/s]Predicting:  65%|██████▌   | 78/120 [00:22<00:11,  3.73batch/s]Predicting:  66%|██████▌   | 79/120 [00:22<00:11,  3.62batch/s]Predicting:  68%|██████▊   | 81/120 [00:23<00:11,  3.26batch/s]Predicting:  68%|██████▊   | 82/120 [00:23<00:10,  3.79batch/s]Predicting:  69%|██████▉   | 83/120 [00:23<00:10,  3.45batch/s]Predicting:  70%|███████   | 84/120 [00:23<00:11,  3.20batch/s]Predicting:  72%|███████▏  | 86/120 [00:24<00:07,  4.55batch/s]Predicting:  72%|███████▎  | 87/120 [00:24<00:08,  4.02batch/s]Predicting:  73%|███████▎  | 88/120 [00:24<00:06,  4.63batch/s]Predicting:  75%|███████▌  | 90/120 [00:24<00:06,  4.74batch/s]Predicting:  77%|███████▋  | 92/120 [00:25<00:05,  4.75batch/s]Predicting:  78%|███████▊  | 93/120 [00:25<00:05,  5.18batch/s]Predicting:  79%|███████▉  | 95/120 [00:25<00:04,  5.32batch/s]Predicting:  80%|████████  | 96/120 [00:26<00:05,  4.71batch/s]Predicting:  81%|████████  | 97/120 [00:26<00:05,  4.30batch/s]Predicting:  82%|████████▏ | 98/120 [00:26<00:05,  4.03batch/s]Predicting:  82%|████████▎ | 99/120 [00:27<00:05,  3.84batch/s]Predicting:  83%|████████▎ | 100/120 [00:27<00:05,  3.88batch/s]Predicting:  84%|████████▍ | 101/120 [00:27<00:05,  3.71batch/s]Predicting:  85%|████████▌ | 102/120 [00:27<00:04,  3.63batch/s]Predicting:  87%|████████▋ | 104/120 [00:28<00:03,  4.96batch/s]Predicting:  88%|████████▊ | 105/120 [00:28<00:03,  4.42batch/s]Predicting:  88%|████████▊ | 106/120 [00:28<00:02,  5.07batch/s]Predicting:  89%|████████▉ | 107/120 [00:29<00:04,  3.16batch/s]Predicting:  90%|█████████ | 108/120 [00:29<00:03,  3.69batch/s]Predicting:  91%|█████████ | 109/120 [00:29<00:03,  3.56batch/s]Predicting:  92%|█████████▏| 110/120 [00:29<00:02,  3.46batch/s]Predicting:  92%|█████████▎| 111/120 [00:30<00:02,  4.15batch/s]Predicting:  94%|█████████▍| 113/120 [00:30<00:01,  5.22batch/s]Predicting:  95%|█████████▌| 114/120 [00:30<00:01,  5.75batch/s]Predicting:  97%|█████████▋| 116/120 [00:30<00:00,  7.01batch/s]Predicting:  99%|█████████▉| 119/120 [00:30<00:00, 10.58batch/s]Predicting: 100%|██████████| 120/120 [00:31<00:00,  3.84batch/s]
INFO:state._cli._tx._predict:Creating anndatas from predictions from manual loop...
... storing 'target_gene' as categorical
... storing 'cell_type' as categorical
... storing 'batch_var' as categorical
... storing 'ctrl_cell_barcode' as categorical
... storing 'target_gene' as categorical
... storing 'cell_type' as categorical
... storing 'batch_var' as categorical
... storing 'ctrl_cell_barcode' as categorical
INFO:state._cli._tx._predict:Saved adata_pred to checkpoints/first_run/eval_last.ckpt/adata_pred.h5ad
INFO:state._cli._tx._predict:Saved adata_real to checkpoints/first_run/eval_last.ckpt/adata_real.h5ad
INFO:state._cli._tx._predict:Computing metrics using cell-eval...
WARNING:cell_eval._evaluator:Output directory checkpoints/first_run/eval_last.ckpt already exists, potential overwrite occurring
INFO:cell_eval.utils:Data appears to be log1p normalized (decimals detected, range [0.00, 7.71])
INFO:cell_eval._evaluator:Input is found to be log-normalized already - skipping transformation.
INFO:cell_eval.utils:Data appears to be log1p normalized (decimals detected, range [0.00, 10.86])
INFO:cell_eval._evaluator:Input is found to be log-normalized already - skipping transformation.
INFO:cell_eval._evaluator:Computing DE for real data
INFO:cell_eval._evaluator:Using the following pdex kwargs: {'exp_post_agg': True, 'is_log1p': True, 'reference': 'non-targeting', 'groupby_key': 'target_gene', 'num_workers': 48, 'batch_size': 2048, 'metric': 'wilcoxon', 'as_polars': True}
INFO:pdex._single_cell:Log1p status: True
INFO:pdex._single_cell:Precomputing masks for each target gene
Identifying target masks:   0%|          | 0/69 [00:00<?, ?it/s]Identifying target masks: 100%|██████████| 69/69 [00:00<00:00, 5923.43it/s]
INFO:pdex._single_cell:Precomputing variable indices for each feature
Identifying variable indices:   0%|          | 0/18080 [00:00<?, ?it/s]Identifying variable indices: 100%|██████████| 18080/18080 [00:00<00:00, 2420691.94it/s]
INFO:pdex._single_cell:Creating shared memory memory matrix for parallel computing
INFO:pdex._single_cell:Creating generator of all combinations: N=1247520
INFO:pdex._single_cell:Creating generator of all batches: N=610
INFO:pdex._single_cell:Initializing parallel processing pool
INFO:pdex._single_cell:Processing batches
Processing batches:   0%|          | 0/610 [00:00<?, ?it/s]Processing batches:   1%|▏         | 9/610 [00:08<09:21,  1.07it/s]Processing batches:   2%|▏         | 10/610 [01:09<1:31:17,  9.13s/it]Processing batches:   2%|▏         | 12/610 [01:09<1:06:02,  6.63s/it]Processing batches:   2%|▏         | 14/610 [01:09<47:20,  4.77s/it]  Processing batches:   2%|▏         | 15/610 [01:10<40:06,  4.04s/it]Processing batches:   3%|▎         | 16/610 [01:11<34:00,  3.43s/it]Processing batches:   3%|▎         | 21/610 [01:11<14:43,  1.50s/it]Processing batches:   4%|▍         | 24/610 [01:13<11:11,  1.15s/it]Processing batches:   5%|▍         | 28/610 [01:13<07:23,  1.31it/s]Processing batches:   5%|▍         | 29/610 [01:14<07:21,  1.32it/s]Processing batches:   5%|▌         | 31/610 [01:15<06:01,  1.60it/s]Processing batches:   5%|▌         | 33/610 [01:16<05:44,  1.68it/s]Processing batches:   6%|▌         | 34/610 [01:16<05:11,  1.85it/s]Processing batches:   9%|▉         | 54/610 [01:16<01:03,  8.80it/s]Processing batches:   9%|▉         | 57/610 [01:20<02:37,  3.51it/s]Processing batches:   9%|▉         | 57/610 [01:37<02:37,  3.51it/s]Processing batches:  10%|▉         | 58/610 [02:27<43:21,  4.71s/it]Processing batches:  10%|▉         | 59/610 [02:29<41:21,  4.50s/it]Processing batches:  12%|█▏        | 74/610 [02:30<14:30,  1.62s/it]Processing batches:  13%|█▎        | 77/610 [02:31<12:38,  1.42s/it]Processing batches:  15%|█▍        | 90/610 [02:31<06:18,  1.37it/s]Processing batches:  17%|█▋        | 103/610 [02:32<03:38,  2.32it/s]Processing batches:  17%|█▋        | 103/610 [02:47<03:38,  2.32it/s]Processing batches:  17%|█▋        | 106/610 [03:28<22:16,  2.65s/it]Processing batches:  18%|█▊        | 111/610 [03:37<20:08,  2.42s/it]Processing batches:  19%|█▉        | 116/610 [03:40<16:32,  2.01s/it]Processing batches:  20%|█▉        | 119/610 [03:41<14:09,  1.73s/it]Processing batches:  20%|██        | 122/610 [03:43<12:07,  1.49s/it]Processing batches:  21%|██        | 127/610 [03:43<08:26,  1.05s/it]Processing batches:  21%|██        | 129/610 [03:52<12:38,  1.58s/it]Processing batches:  23%|██▎       | 143/610 [03:53<05:03,  1.54it/s]Processing batches:  24%|██▍       | 148/610 [03:53<03:56,  1.95it/s]Processing batches:  25%|██▌       | 153/610 [03:53<02:57,  2.57it/s]Processing batches:  25%|██▌       | 153/610 [04:12<02:57,  2.57it/s]Processing batches:  25%|██▌       | 154/610 [04:29<20:46,  2.73s/it]Processing batches:  26%|██▌       | 156/610 [04:34<20:41,  2.73s/it]Processing batches:  26%|██▌       | 158/610 [04:37<18:38,  2.48s/it]Processing batches:  26%|██▌       | 160/610 [04:42<19:03,  2.54s/it]Processing batches:  26%|██▋       | 161/610 [04:43<16:44,  2.24s/it]Processing batches:  27%|██▋       | 162/610 [04:46<17:38,  2.36s/it]Processing batches:  27%|██▋       | 164/610 [04:47<13:40,  1.84s/it]Processing batches:  27%|██▋       | 165/610 [04:47<11:30,  1.55s/it]Processing batches:  27%|██▋       | 167/610 [04:52<12:55,  1.75s/it]Processing batches:  28%|██▊       | 173/610 [04:54<06:52,  1.06it/s]Processing batches:  30%|███       | 183/610 [04:56<03:48,  1.87it/s]Processing batches:  31%|███       | 190/610 [04:58<02:49,  2.48it/s]Processing batches:  32%|███▏      | 194/610 [05:06<05:27,  1.27it/s]Processing batches:  32%|███▏      | 197/610 [05:06<04:32,  1.52it/s]Processing batches:  33%|███▎      | 199/610 [05:07<04:24,  1.55it/s]Processing batches:  33%|███▎      | 202/610 [05:35<19:14,  2.83s/it]Processing batches:  33%|███▎      | 203/610 [05:35<17:16,  2.55s/it]Processing batches:  33%|███▎      | 204/610 [05:43<21:57,  3.25s/it]Processing batches:  34%|███▎      | 205/610 [05:43<18:38,  2.76s/it]Processing batches:  34%|███▍      | 206/610 [05:45<17:41,  2.63s/it]Processing batches:  34%|███▍      | 207/610 [05:49<19:26,  2.89s/it]Processing batches:  34%|███▍      | 208/610 [05:52<18:25,  2.75s/it]Processing batches:  34%|███▍      | 210/610 [05:53<12:42,  1.91s/it]Processing batches:  35%|███▍      | 211/610 [05:54<11:14,  1.69s/it]Processing batches:  35%|███▍      | 212/610 [05:54<08:52,  1.34s/it]Processing batches:  35%|███▍      | 213/610 [05:55<08:28,  1.28s/it]Processing batches:  35%|███▌      | 214/610 [05:56<07:15,  1.10s/it]Processing batches:  35%|███▌      | 216/610 [05:56<05:18,  1.24it/s]Processing batches:  36%|███▌      | 218/610 [05:57<04:17,  1.52it/s]Processing batches:  36%|███▌      | 219/610 [05:59<06:07,  1.06it/s]Processing batches:  36%|███▋      | 222/610 [06:08<12:25,  1.92s/it]Processing batches:  37%|███▋      | 223/610 [06:09<10:27,  1.62s/it]Processing batches:  37%|███▋      | 225/610 [06:09<07:13,  1.13s/it]Processing batches:  37%|███▋      | 227/610 [06:10<05:24,  1.18it/s]Processing batches:  39%|███▊      | 236/610 [06:10<01:56,  3.21it/s]Processing batches:  39%|███▉      | 238/610 [06:10<01:40,  3.72it/s]Processing batches:  40%|███▉      | 241/610 [06:10<01:18,  4.69it/s]Processing batches:  40%|███▉      | 243/610 [06:11<01:16,  4.82it/s]Processing batches:  40%|████      | 245/610 [06:11<01:26,  4.23it/s]Processing batches:  41%|████      | 249/610 [06:12<00:57,  6.29it/s]Processing batches:  41%|████      | 249/610 [06:28<00:57,  6.29it/s]Processing batches:  41%|████      | 250/610 [06:37<19:25,  3.24s/it]Processing batches:  41%|████      | 251/610 [06:37<16:40,  2.79s/it]Processing batches:  41%|████▏     | 253/610 [06:45<18:46,  3.15s/it]Processing batches:  42%|████▏     | 254/610 [06:48<18:40,  3.15s/it]Processing batches:  42%|████▏     | 255/610 [06:49<16:02,  2.71s/it]Processing batches:  42%|████▏     | 256/610 [06:51<14:45,  2.50s/it]Processing batches:  42%|████▏     | 257/610 [06:52<13:30,  2.30s/it]Processing batches:  42%|████▏     | 258/610 [06:53<11:06,  1.89s/it]Processing batches:  42%|████▏     | 259/610 [06:54<08:57,  1.53s/it]Processing batches:  43%|████▎     | 260/610 [06:55<07:51,  1.35s/it]Processing batches:  43%|████▎     | 261/610 [07:01<15:29,  2.66s/it]Processing batches:  44%|████▍     | 267/610 [07:02<05:29,  1.04it/s]Processing batches:  44%|████▍     | 269/610 [07:04<05:42,  1.00s/it]Processing batches:  44%|████▍     | 270/610 [07:06<06:18,  1.11s/it]Processing batches:  45%|████▍     | 272/610 [07:11<08:12,  1.46s/it]Processing batches:  45%|████▌     | 275/610 [07:20<11:54,  2.13s/it]Processing batches:  45%|████▌     | 276/610 [07:21<10:52,  1.95s/it]Processing batches:  45%|████▌     | 277/610 [07:24<11:33,  2.08s/it]Processing batches:  46%|████▌     | 278/610 [07:24<09:34,  1.73s/it]Processing batches:  46%|████▌     | 282/610 [07:25<05:17,  1.03it/s]Processing batches:  46%|████▋     | 283/610 [07:26<05:16,  1.03it/s]Processing batches:  48%|████▊     | 293/610 [07:27<01:37,  3.25it/s]Processing batches:  49%|████▊     | 296/610 [07:30<02:39,  1.97it/s]Processing batches:  49%|████▉     | 298/610 [07:41<07:09,  1.38s/it]Processing batches:  49%|████▉     | 299/610 [07:53<13:34,  2.62s/it]Processing batches:  49%|████▉     | 300/610 [07:53<11:46,  2.28s/it]Processing batches:  50%|████▉     | 302/610 [07:56<10:05,  1.97s/it]Processing batches:  50%|████▉     | 304/610 [07:57<08:23,  1.65s/it]Processing batches:  50%|█████     | 305/610 [08:00<09:07,  1.80s/it]Processing batches:  50%|█████     | 306/610 [08:00<07:42,  1.52s/it]Processing batches:  50%|█████     | 307/610 [08:01<06:52,  1.36s/it]Processing batches:  50%|█████     | 308/610 [08:02<05:54,  1.17s/it]Processing batches:  51%|█████     | 310/610 [08:04<05:19,  1.07s/it]Processing batches:  51%|█████▏    | 313/610 [08:05<04:02,  1.22it/s]Processing batches:  51%|█████▏    | 314/610 [08:06<04:22,  1.13it/s]Processing batches:  52%|█████▏    | 315/610 [08:08<05:32,  1.13s/it]Processing batches:  52%|█████▏    | 317/610 [08:11<05:39,  1.16s/it]Processing batches:  52%|█████▏    | 318/610 [08:13<06:25,  1.32s/it]Processing batches:  52%|█████▏    | 319/610 [08:14<06:13,  1.28s/it]Processing batches:  52%|█████▏    | 320/610 [08:18<09:43,  2.01s/it]Processing batches:  53%|█████▎    | 321/610 [08:18<07:26,  1.55s/it]Processing batches:  53%|█████▎    | 322/610 [08:20<07:23,  1.54s/it]Processing batches:  53%|█████▎    | 323/610 [08:28<16:09,  3.38s/it]Processing batches:  53%|█████▎    | 324/610 [08:31<16:07,  3.38s/it]Processing batches:  54%|█████▍    | 330/610 [08:32<05:09,  1.10s/it]Processing batches:  54%|█████▍    | 331/610 [08:33<04:38,  1.00it/s]Processing batches:  55%|█████▍    | 333/610 [08:33<03:34,  1.29it/s]Processing batches:  55%|█████▌    | 338/610 [08:35<02:22,  1.91it/s]Processing batches:  56%|█████▌    | 340/610 [08:35<02:03,  2.18it/s]Processing batches:  56%|█████▌    | 342/610 [08:38<03:06,  1.43it/s]Processing batches:  57%|█████▋    | 345/610 [08:41<03:22,  1.31it/s]Processing batches:  57%|█████▋    | 346/610 [08:49<07:47,  1.77s/it]Processing batches:  57%|█████▋    | 347/610 [08:50<07:23,  1.69s/it]Processing batches:  57%|█████▋    | 348/610 [09:01<15:32,  3.56s/it]Processing batches:  57%|█████▋    | 349/610 [09:02<12:34,  2.89s/it]Processing batches:  58%|█████▊    | 351/610 [09:06<10:52,  2.52s/it]Processing batches:  58%|█████▊    | 352/610 [09:06<08:45,  2.04s/it]Processing batches:  58%|█████▊    | 353/610 [09:08<08:54,  2.08s/it]Processing batches:  58%|█████▊    | 355/610 [09:10<06:57,  1.64s/it]Processing batches:  59%|█████▊    | 357/610 [09:10<04:30,  1.07s/it]Processing batches:  59%|█████▊    | 358/610 [09:10<03:45,  1.12it/s]Processing batches:  59%|█████▉    | 359/610 [09:11<03:03,  1.36it/s]Processing batches:  59%|█████▉    | 360/610 [09:12<03:43,  1.12it/s]Processing batches:  59%|█████▉    | 361/610 [09:13<04:12,  1.02s/it]Processing batches:  59%|█████▉    | 362/610 [09:13<03:13,  1.28it/s]Processing batches:  60%|█████▉    | 363/610 [09:16<05:02,  1.23s/it]Processing batches:  60%|█████▉    | 364/610 [09:17<04:27,  1.09s/it]Processing batches:  60%|█████▉    | 365/610 [09:19<05:31,  1.35s/it]Processing batches:  60%|██████    | 366/610 [09:21<06:52,  1.69s/it]Processing batches:  60%|██████    | 367/610 [09:21<05:16,  1.30s/it]Processing batches:  60%|██████    | 368/610 [09:27<10:19,  2.56s/it]Processing batches:  60%|██████    | 369/610 [09:28<07:48,  1.94s/it]Processing batches:  61%|██████    | 370/610 [09:28<06:33,  1.64s/it]Processing batches:  61%|██████    | 371/610 [09:42<20:38,  5.18s/it]Processing batches:  61%|██████    | 373/610 [09:42<11:09,  2.82s/it]Processing batches:  61%|██████▏   | 374/610 [09:42<08:37,  2.19s/it]Processing batches:  62%|██████▏   | 377/610 [09:43<04:21,  1.12s/it]Processing batches:  62%|██████▏   | 378/610 [09:43<03:42,  1.04it/s]Processing batches:  62%|██████▏   | 380/610 [09:43<02:27,  1.56it/s]Processing batches:  63%|██████▎   | 383/610 [09:44<01:38,  2.32it/s]Processing batches:  64%|██████▎   | 388/610 [09:44<00:54,  4.09it/s]Processing batches:  64%|██████▍   | 390/610 [09:44<00:46,  4.71it/s]Processing batches:  64%|██████▍   | 391/610 [09:44<00:45,  4.83it/s]Processing batches:  64%|██████▍   | 392/610 [09:44<00:42,  5.13it/s]Processing batches:  64%|██████▍   | 393/610 [09:47<02:06,  1.72it/s]Processing batches:  65%|██████▍   | 394/610 [09:55<08:22,  2.33s/it]Processing batches:  65%|██████▍   | 395/610 [09:58<08:51,  2.47s/it]Processing batches:  65%|██████▍   | 396/610 [10:10<17:21,  4.87s/it]Processing batches:  65%|██████▌   | 399/610 [10:15<10:50,  3.08s/it]Processing batches:  66%|██████▌   | 401/610 [10:16<07:50,  2.25s/it]Processing batches:  66%|██████▌   | 402/610 [10:17<06:55,  2.00s/it]Processing batches:  66%|██████▌   | 403/610 [10:18<06:28,  1.88s/it]Processing batches:  66%|██████▌   | 404/610 [10:19<05:51,  1.71s/it]Processing batches:  67%|██████▋   | 408/610 [10:21<03:06,  1.08it/s]Processing batches:  67%|██████▋   | 409/610 [10:22<03:23,  1.01s/it]Processing batches:  67%|██████▋   | 411/610 [10:24<03:04,  1.08it/s]Processing batches:  68%|██████▊   | 412/610 [10:25<03:31,  1.07s/it]Processing batches:  68%|██████▊   | 413/610 [10:28<04:34,  1.39s/it]Processing batches:  68%|██████▊   | 414/610 [10:29<04:43,  1.45s/it]Processing batches:  68%|██████▊   | 416/610 [10:36<06:52,  2.13s/it]Processing batches:  68%|██████▊   | 417/610 [10:36<05:45,  1.79s/it]Processing batches:  69%|██████▊   | 418/610 [10:37<04:39,  1.46s/it]Processing batches:  69%|██████▊   | 419/610 [10:38<04:24,  1.38s/it]Processing batches:  69%|██████▉   | 420/610 [10:48<11:42,  3.70s/it]Processing batches:  69%|██████▉   | 421/610 [10:49<09:33,  3.04s/it]Processing batches:  70%|██████▉   | 424/610 [10:49<04:22,  1.41s/it]Processing batches:  70%|██████▉   | 425/610 [10:50<03:49,  1.24s/it]Processing batches:  70%|███████   | 427/610 [10:51<03:00,  1.01it/s]Processing batches:  70%|███████   | 430/610 [10:52<02:06,  1.43it/s]Processing batches:  71%|███████   | 431/610 [10:52<01:53,  1.58it/s]Processing batches:  71%|███████▏  | 435/610 [10:53<01:07,  2.60it/s]Processing batches:  72%|███████▏  | 437/610 [10:53<00:52,  3.27it/s]Processing batches:  72%|███████▏  | 439/610 [10:53<00:41,  4.09it/s]Processing batches:  72%|███████▏  | 440/610 [10:56<01:42,  1.66it/s]Processing batches:  72%|███████▏  | 441/610 [10:57<02:10,  1.29it/s]Processing batches:  72%|███████▏  | 442/610 [11:02<04:22,  1.56s/it]Processing batches:  73%|███████▎  | 443/610 [11:07<06:49,  2.45s/it]Processing batches:  73%|███████▎  | 444/610 [11:16<11:15,  4.07s/it]Processing batches:  73%|███████▎  | 445/610 [11:29<17:23,  6.33s/it]Processing batches:  73%|███████▎  | 448/610 [11:29<08:07,  3.01s/it]Processing batches:  74%|███████▎  | 449/610 [11:29<06:35,  2.46s/it]Processing batches:  74%|███████▍  | 450/610 [11:29<05:09,  1.93s/it]Processing batches:  74%|███████▍  | 452/610 [11:30<03:16,  1.24s/it]Processing batches:  75%|███████▍  | 455/610 [11:30<01:50,  1.40it/s]Processing batches:  75%|███████▍  | 456/610 [11:30<01:34,  1.63it/s]Processing batches:  75%|███████▍  | 457/610 [11:30<01:29,  1.71it/s]Processing batches:  75%|███████▌  | 460/610 [11:32<01:34,  1.59it/s]Processing batches:  76%|███████▌  | 462/610 [11:34<01:29,  1.65it/s]Processing batches:  76%|███████▌  | 463/610 [11:36<02:10,  1.13it/s]Processing batches:  76%|███████▌  | 464/610 [11:42<04:56,  2.03s/it]Processing batches:  76%|███████▌  | 465/610 [11:43<04:25,  1.83s/it]Processing batches:  76%|███████▋  | 466/610 [11:45<04:00,  1.67s/it]Processing batches:  77%|███████▋  | 467/610 [11:46<03:54,  1.64s/it]Processing batches:  77%|███████▋  | 468/610 [11:55<08:48,  3.72s/it]Processing batches:  77%|███████▋  | 469/610 [11:57<07:16,  3.09s/it]Processing batches:  77%|███████▋  | 471/610 [11:57<04:07,  1.78s/it]Processing batches:  77%|███████▋  | 472/610 [11:58<03:22,  1.47s/it]Processing batches:  78%|███████▊  | 473/610 [11:58<02:44,  1.20s/it]Processing batches:  78%|███████▊  | 474/610 [12:00<02:57,  1.30s/it]Processing batches:  79%|███████▉  | 481/610 [12:00<00:56,  2.27it/s]Processing batches:  79%|███████▉  | 483/610 [12:01<00:53,  2.36it/s]Processing batches:  79%|███████▉  | 484/610 [12:02<01:07,  1.87it/s]Processing batches:  80%|████████  | 488/610 [12:07<01:31,  1.33it/s]Processing batches:  80%|████████  | 489/610 [12:09<01:52,  1.08it/s]Processing batches:  80%|████████  | 491/610 [12:12<02:21,  1.19s/it]Processing batches:  81%|████████  | 492/610 [12:22<05:02,  2.56s/it]Processing batches:  81%|████████  | 493/610 [12:25<05:26,  2.79s/it]Processing batches:  81%|████████  | 494/610 [12:26<04:32,  2.35s/it]Processing batches:  81%|████████  | 495/610 [12:36<08:03,  4.21s/it]Processing batches:  81%|████████▏ | 496/610 [12:38<06:40,  3.51s/it]Processing batches:  82%|████████▏ | 501/610 [12:39<02:30,  1.38s/it]Processing batches:  83%|████████▎ | 507/610 [12:39<01:10,  1.47it/s]Processing batches:  83%|████████▎ | 508/610 [12:40<01:11,  1.43it/s]Processing batches:  83%|████████▎ | 509/610 [12:41<01:15,  1.35it/s]Processing batches:  84%|████████▎ | 510/610 [12:42<01:22,  1.21it/s]Processing batches:  84%|████████▍ | 511/610 [12:44<01:42,  1.03s/it]Processing batches:  84%|████████▍ | 512/610 [12:50<03:28,  2.12s/it]Processing batches:  84%|████████▍ | 513/610 [12:52<03:08,  1.95s/it]Processing batches:  84%|████████▍ | 514/610 [12:53<02:58,  1.86s/it]Processing batches:  84%|████████▍ | 515/610 [12:54<02:30,  1.58s/it]Processing batches:  85%|████████▍ | 516/610 [13:04<05:55,  3.79s/it]Processing batches:  85%|████████▍ | 517/610 [13:05<04:40,  3.02s/it]Processing batches:  85%|████████▌ | 519/610 [13:06<02:49,  1.86s/it]Processing batches:  85%|████████▌ | 520/610 [13:06<02:11,  1.46s/it]Processing batches:  85%|████████▌ | 521/610 [13:06<01:44,  1.17s/it]Processing batches:  86%|████████▌ | 522/610 [13:13<04:04,  2.78s/it]Processing batches:  86%|████████▌ | 525/610 [13:14<01:54,  1.35s/it]Processing batches:  86%|████████▋ | 527/610 [13:14<01:17,  1.07it/s]Processing batches:  87%|████████▋ | 529/610 [13:14<00:57,  1.42it/s]Processing batches:  87%|████████▋ | 531/610 [13:14<00:39,  2.00it/s]Processing batches:  87%|████████▋ | 532/610 [13:15<00:33,  2.32it/s]Processing batches:  87%|████████▋ | 533/610 [13:15<00:30,  2.56it/s]Processing batches:  88%|████████▊ | 534/610 [13:15<00:26,  2.84it/s]Processing batches:  88%|████████▊ | 536/610 [13:15<00:22,  3.30it/s]Processing batches:  88%|████████▊ | 539/610 [13:20<00:57,  1.23it/s]Processing batches:  89%|████████▊ | 540/610 [13:29<02:44,  2.34s/it]Processing batches:  89%|████████▊ | 541/610 [13:34<03:15,  2.84s/it]Processing batches:  89%|████████▉ | 542/610 [13:34<02:39,  2.35s/it]Processing batches:  89%|████████▉ | 543/610 [13:43<04:19,  3.88s/it]Processing batches:  89%|████████▉ | 544/610 [13:44<03:19,  3.02s/it]Processing batches:  89%|████████▉ | 545/610 [13:46<03:08,  2.90s/it]Processing batches:  90%|████████▉ | 546/610 [13:46<02:17,  2.15s/it]Processing batches:  91%|█████████ | 553/610 [13:47<00:33,  1.72it/s]Processing batches:  91%|█████████ | 555/610 [13:48<00:31,  1.77it/s]Processing batches:  91%|█████████▏| 557/610 [13:48<00:28,  1.88it/s]Processing batches:  92%|█████████▏| 559/610 [13:52<00:41,  1.23it/s]Processing batches:  92%|█████████▏| 560/610 [13:58<01:22,  1.65s/it]Processing batches:  92%|█████████▏| 561/610 [13:59<01:15,  1.54s/it]Processing batches:  92%|█████████▏| 562/610 [14:01<01:23,  1.75s/it]Processing batches:  92%|█████████▏| 564/610 [14:06<01:34,  2.05s/it]Processing batches:  93%|█████████▎| 567/610 [14:08<00:56,  1.32s/it]Processing batches:  93%|█████████▎| 569/610 [14:08<00:40,  1.02it/s]Processing batches:  93%|█████████▎| 570/610 [14:08<00:33,  1.21it/s]Processing batches:  94%|█████████▎| 571/610 [14:16<01:26,  2.21s/it]Processing batches:  94%|█████████▍| 572/610 [14:17<01:12,  1.91s/it]Processing batches:  95%|█████████▍| 577/610 [14:17<00:25,  1.30it/s]Processing batches:  95%|█████████▍| 578/610 [14:17<00:21,  1.47it/s]Processing batches:  95%|█████████▍| 579/610 [14:17<00:18,  1.70it/s]Processing batches:  95%|█████████▌| 581/610 [14:18<00:12,  2.29it/s]Processing batches:  96%|█████████▌| 584/610 [14:18<00:07,  3.53it/s]Processing batches:  96%|█████████▌| 586/610 [14:19<00:09,  2.46it/s]Processing batches:  96%|█████████▌| 587/610 [14:24<00:26,  1.17s/it]Processing batches:  97%|█████████▋| 590/610 [14:28<00:25,  1.25s/it]Processing batches:  97%|█████████▋| 591/610 [14:29<00:22,  1.17s/it]Processing batches:  97%|█████████▋| 593/610 [14:32<00:22,  1.29s/it]Processing batches: 100%|██████████| 610/610 [14:32<00:00,  1.43s/it]
INFO:pdex._single_cell:Flattening results
INFO:pdex._single_cell:Closing shared memory pool
INFO:cell_eval._evaluator:Writing real DE results to: hepg2_real_de.csv
INFO:cell_eval._evaluator:Computing DE for pred data
INFO:cell_eval._evaluator:Using the following pdex kwargs: {'exp_post_agg': True, 'is_log1p': True, 'reference': 'non-targeting', 'groupby_key': 'target_gene', 'num_workers': 48, 'batch_size': 2048, 'metric': 'wilcoxon', 'as_polars': True}
INFO:pdex._single_cell:Log1p status: True
INFO:pdex._single_cell:Precomputing masks for each target gene
Identifying target masks:   0%|          | 0/69 [00:00<?, ?it/s]Identifying target masks: 100%|██████████| 69/69 [00:00<00:00, 13148.89it/s]
INFO:pdex._single_cell:Precomputing variable indices for each feature
Identifying variable indices:   0%|          | 0/18080 [00:00<?, ?it/s]Identifying variable indices: 100%|██████████| 18080/18080 [00:00<00:00, 2678854.61it/s]
INFO:pdex._single_cell:Creating shared memory memory matrix for parallel computing
INFO:pdex._single_cell:Creating generator of all combinations: N=1247520
INFO:pdex._single_cell:Creating generator of all batches: N=610
INFO:pdex._single_cell:Initializing parallel processing pool
INFO:pdex._single_cell:Processing batches
Processing batches:   0%|          | 0/610 [00:00<?, ?it/s]Processing batches:   1%|▏         | 9/610 [00:08<09:55,  1.01it/s]Processing batches:   2%|▏         | 10/610 [01:13<1:36:27,  9.65s/it]Processing batches:   2%|▏         | 12/610 [01:15<1:11:56,  7.22s/it]Processing batches:   2%|▏         | 15/610 [01:16<46:41,  4.71s/it]  Processing batches:   3%|▎         | 21/610 [01:17<22:35,  2.30s/it]Processing batches:   4%|▎         | 22/610 [01:31<35:18,  3.60s/it]Processing batches:   6%|▌         | 34/610 [01:31<12:06,  1.26s/it]Processing batches:   9%|▉         | 57/610 [01:31<04:11,  2.19it/s]Processing batches:   9%|▉         | 57/610 [01:50<04:11,  2.19it/s]Processing batches:  10%|▉         | 58/610 [02:25<22:53,  2.49s/it]Processing batches:  10%|▉         | 59/610 [02:26<22:06,  2.41s/it]Processing batches:  11%|█         | 65/610 [02:28<16:25,  1.81s/it]Processing batches:  11%|█▏        | 69/610 [02:31<14:00,  1.55s/it]Processing batches:  12%|█▏        | 73/610 [02:31<10:34,  1.18s/it]Processing batches:  12%|█▏        | 76/610 [02:32<08:56,  1.00s/it]Processing batches:  13%|█▎        | 79/610 [02:32<06:58,  1.27it/s]Processing batches:  13%|█▎        | 81/610 [02:33<06:01,  1.47it/s]Processing batches:  14%|█▍        | 84/610 [02:33<04:38,  1.89it/s]Processing batches:  14%|█▍        | 86/610 [02:33<03:45,  2.32it/s]Processing batches:  14%|█▍        | 88/610 [02:33<03:06,  2.80it/s]Processing batches:  15%|█▍        | 90/610 [02:34<02:49,  3.07it/s]Processing batches:  15%|█▌        | 94/610 [02:34<01:48,  4.74it/s]Processing batches:  16%|█▌        | 96/610 [02:35<02:44,  3.12it/s]Processing batches:  16%|█▌        | 98/610 [02:38<04:52,  1.75it/s]Processing batches:  16%|█▌        | 99/610 [02:42<08:37,  1.01s/it]Processing batches:  17%|█▋        | 101/610 [02:54<21:57,  2.59s/it]Processing batches:  17%|█▋        | 103/610 [02:55<15:43,  1.86s/it]Processing batches:  17%|█▋        | 104/610 [02:55<13:57,  1.66s/it]Processing batches:  17%|█▋        | 106/610 [03:48<1:22:52,  9.87s/it]Processing batches:  20%|██        | 122/610 [03:48<16:52,  2.07s/it]  Processing batches:  21%|██        | 126/610 [03:49<13:17,  1.65s/it]Processing batches:  21%|██▏       | 130/610 [03:49<10:04,  1.26s/it]Processing batches:  22%|██▏       | 132/610 [03:56<12:33,  1.58s/it]Processing batches:  22%|██▏       | 134/610 [03:56<10:49,  1.36s/it]Processing batches:  23%|██▎       | 140/610 [03:57<06:13,  1.26it/s]Processing batches:  23%|██▎       | 142/610 [03:57<05:23,  1.45it/s]Processing batches:  24%|██▎       | 144/610 [03:57<04:35,  1.69it/s]Processing batches:  24%|██▍       | 146/610 [03:58<03:54,  1.98it/s]Processing batches:  24%|██▍       | 148/610 [03:58<03:14,  2.37it/s]Processing batches:  24%|██▍       | 149/610 [04:11<17:34,  2.29s/it]Processing batches:  25%|██▌       | 154/610 [04:55<42:11,  5.55s/it]Processing batches:  25%|██▌       | 155/610 [04:56<37:57,  5.01s/it]Processing batches:  26%|██▌       | 157/610 [04:57<28:23,  3.76s/it]Processing batches:  26%|██▌       | 160/610 [05:01<21:48,  2.91s/it]Processing batches:  28%|██▊       | 168/610 [05:03<09:49,  1.33s/it]Processing batches:  28%|██▊       | 170/610 [05:04<08:42,  1.19s/it]Processing batches:  29%|██▊       | 174/610 [05:07<07:46,  1.07s/it]Processing batches:  30%|███       | 183/610 [05:12<05:53,  1.21it/s]Processing batches:  30%|███       | 184/610 [05:13<05:34,  1.27it/s]Processing batches:  31%|███       | 189/610 [05:14<04:13,  1.66it/s]Processing batches:  31%|███       | 190/610 [05:14<03:57,  1.77it/s]Processing batches:  31%|███▏      | 192/610 [05:15<03:33,  1.96it/s]Processing batches:  32%|███▏      | 193/610 [05:15<03:43,  1.86it/s]Processing batches:  32%|███▏      | 197/610 [05:22<07:16,  1.06s/it]Processing batches:  32%|███▏      | 198/610 [05:24<07:53,  1.15s/it]Processing batches:  33%|███▎      | 199/610 [05:26<08:11,  1.20s/it]Processing batches:  33%|███▎      | 200/610 [05:27<08:37,  1.26s/it]Processing batches:  33%|███▎      | 201/610 [05:29<09:21,  1.37s/it]Processing batches:  33%|███▎      | 202/610 [06:09<1:09:37, 10.24s/it]Processing batches:  33%|███▎      | 203/610 [06:09<52:32,  7.75s/it]  Processing batches:  33%|███▎      | 204/610 [06:11<41:48,  6.18s/it]Processing batches:  34%|███▍      | 206/610 [06:11<24:02,  3.57s/it]Processing batches:  34%|███▍      | 207/610 [06:13<21:27,  3.19s/it]Processing batches:  34%|███▍      | 209/610 [06:14<13:33,  2.03s/it]Processing batches:  35%|███▍      | 212/610 [06:24<17:54,  2.70s/it]Processing batches:  35%|███▌      | 214/610 [06:24<12:44,  1.93s/it]Processing batches:  36%|███▌      | 217/610 [06:25<08:04,  1.23s/it]Processing batches:  37%|███▋      | 223/610 [06:25<03:48,  1.69it/s]Processing batches:  37%|███▋      | 225/610 [06:26<03:24,  1.88it/s]Processing batches:  37%|███▋      | 228/610 [06:26<02:28,  2.57it/s]Processing batches:  38%|███▊      | 230/610 [06:26<02:05,  3.03it/s]Processing batches:  38%|███▊      | 232/610 [06:28<03:07,  2.02it/s]Processing batches:  38%|███▊      | 233/610 [06:28<02:48,  2.24it/s]Processing batches:  39%|███▊      | 236/610 [06:29<01:58,  3.15it/s]Processing batches:  40%|████      | 245/610 [06:34<03:13,  1.89it/s]Processing batches:  40%|████      | 246/610 [06:36<03:44,  1.62it/s]Processing batches:  40%|████      | 247/610 [06:37<04:12,  1.44it/s]Processing batches:  41%|████      | 248/610 [06:39<05:03,  1.19it/s]Processing batches:  41%|████      | 249/610 [06:41<06:07,  1.02s/it]Processing batches:  41%|████      | 250/610 [07:14<42:39,  7.11s/it]Processing batches:  41%|████▏     | 252/610 [07:26<40:04,  6.72s/it]Processing batches:  42%|████▏     | 255/610 [07:28<25:01,  4.23s/it]Processing batches:  43%|████▎     | 262/610 [07:44<17:46,  3.06s/it]Processing batches:  43%|████▎     | 263/610 [07:45<16:29,  2.85s/it]Processing batches:  43%|████▎     | 264/610 [07:46<14:28,  2.51s/it]Processing batches:  43%|████▎     | 265/610 [07:49<15:05,  2.62s/it]Processing batches:  44%|████▎     | 266/610 [07:49<12:22,  2.16s/it]Processing batches:  44%|████▍     | 268/610 [07:50<09:16,  1.63s/it]Processing batches:  45%|████▌     | 277/610 [08:01<07:26,  1.34s/it]Processing batches:  46%|████▋     | 283/610 [08:01<04:32,  1.20it/s]Processing batches:  49%|████▊     | 297/610 [08:02<02:00,  2.61it/s]Processing batches:  49%|████▊     | 297/610 [08:21<02:00,  2.61it/s]Processing batches:  49%|████▉     | 298/610 [08:27<09:03,  1.74s/it]Processing batches:  49%|████▉     | 300/610 [08:29<08:19,  1.61s/it]Processing batches:  49%|████▉     | 301/610 [08:32<09:08,  1.78s/it]Processing batches:  50%|████▉     | 302/610 [08:33<08:25,  1.64s/it]Processing batches:  50%|████▉     | 303/610 [08:34<07:56,  1.55s/it]Processing batches:  50%|█████     | 305/610 [08:34<06:05,  1.20s/it]Processing batches:  50%|█████     | 306/610 [08:40<09:29,  1.87s/it]Processing batches:  50%|█████     | 308/610 [08:42<08:10,  1.62s/it]Processing batches:  51%|█████     | 310/610 [08:45<08:03,  1.61s/it]Processing batches:  51%|█████     | 311/610 [08:48<09:36,  1.93s/it]Processing batches:  51%|█████     | 312/610 [08:51<10:43,  2.16s/it]Processing batches:  51%|█████▏    | 313/610 [08:52<08:25,  1.70s/it]Processing batches:  52%|█████▏    | 315/610 [08:52<05:31,  1.12s/it]Processing batches:  52%|█████▏    | 318/610 [08:52<03:14,  1.50it/s]Processing batches:  52%|█████▏    | 319/610 [08:58<07:52,  1.62s/it]Processing batches:  52%|█████▏    | 320/610 [09:01<08:32,  1.77s/it]Processing batches:  53%|█████▎    | 322/610 [09:01<06:01,  1.26s/it]Processing batches:  53%|█████▎    | 324/610 [09:03<05:09,  1.08s/it]Processing batches:  53%|█████▎    | 325/610 [09:04<04:41,  1.01it/s]Processing batches:  54%|█████▍    | 328/610 [09:04<02:48,  1.68it/s]Processing batches:  54%|█████▍    | 330/610 [09:05<02:44,  1.70it/s]Processing batches:  55%|█████▍    | 333/610 [09:05<01:49,  2.52it/s]Processing batches:  55%|█████▍    | 334/610 [09:06<01:55,  2.40it/s]Processing batches:  56%|█████▌    | 340/610 [09:07<01:01,  4.37it/s]Processing batches:  56%|█████▌    | 342/610 [09:07<01:01,  4.35it/s]Processing batches:  56%|█████▌    | 343/610 [09:17<06:57,  1.56s/it]Processing batches:  57%|█████▋    | 345/610 [09:18<05:24,  1.22s/it]Processing batches:  57%|█████▋    | 346/610 [09:40<20:28,  4.65s/it]Processing batches:  57%|█████▋    | 347/610 [09:41<17:30,  3.99s/it]Processing batches:  57%|█████▋    | 348/610 [09:42<14:19,  3.28s/it]Processing batches:  57%|█████▋    | 349/610 [09:50<19:34,  4.50s/it]Processing batches:  58%|█████▊    | 354/610 [09:51<07:33,  1.77s/it]Processing batches:  58%|█████▊    | 355/610 [09:56<09:23,  2.21s/it]Processing batches:  59%|█████▊    | 358/610 [09:56<06:03,  1.44s/it]Processing batches:  59%|█████▉    | 359/610 [10:00<07:28,  1.79s/it]Processing batches:  59%|█████▉    | 360/610 [10:06<10:27,  2.51s/it]Processing batches:  59%|█████▉    | 362/610 [10:07<07:25,  1.79s/it]Processing batches:  60%|█████▉    | 363/610 [10:08<07:08,  1.74s/it]Processing batches:  60%|█████▉    | 365/610 [10:08<04:38,  1.14s/it]Processing batches:  60%|██████    | 366/610 [10:09<04:27,  1.10s/it]Processing batches:  60%|██████    | 367/610 [10:22<15:07,  3.74s/it]Processing batches:  60%|██████    | 369/610 [10:23<09:52,  2.46s/it]Processing batches:  61%|██████▏   | 375/610 [10:25<04:13,  1.08s/it]Processing batches:  62%|██████▏   | 377/610 [10:25<03:25,  1.13it/s]Processing batches:  64%|██████▍   | 392/610 [10:25<00:59,  3.69it/s]Processing batches:  64%|██████▍   | 392/610 [10:42<00:59,  3.69it/s]Processing batches:  65%|██████▍   | 394/610 [10:49<05:54,  1.64s/it]Processing batches:  65%|██████▍   | 395/610 [10:51<05:57,  1.66s/it]Processing batches:  65%|██████▌   | 397/610 [10:57<06:57,  1.96s/it]Processing batches:  65%|██████▌   | 398/610 [10:58<06:17,  1.78s/it]Processing batches:  66%|██████▌   | 400/610 [11:01<06:19,  1.81s/it]Processing batches:  66%|██████▋   | 405/610 [11:06<04:49,  1.41s/it]Processing batches:  67%|██████▋   | 406/610 [11:06<04:17,  1.26s/it]Processing batches:  67%|██████▋   | 408/610 [11:18<08:12,  2.44s/it]Processing batches:  67%|██████▋   | 411/610 [11:20<05:53,  1.77s/it]Processing batches:  68%|██████▊   | 412/610 [11:21<05:44,  1.74s/it]Processing batches:  68%|██████▊   | 413/610 [11:22<04:55,  1.50s/it]Processing batches:  68%|██████▊   | 416/610 [11:38<10:22,  3.21s/it]Processing batches:  69%|██████▉   | 422/610 [11:40<05:05,  1.62s/it]Processing batches:  70%|██████▉   | 425/610 [11:40<03:38,  1.18s/it]Processing batches:  70%|██████▉   | 426/610 [11:41<03:14,  1.06s/it]Processing batches:  71%|███████   | 433/610 [11:42<01:45,  1.68it/s]Processing batches:  71%|███████   | 434/610 [11:42<01:40,  1.75it/s]Processing batches:  72%|███████▏  | 441/610 [11:43<00:58,  2.89it/s]Processing batches:  72%|███████▏  | 442/610 [12:03<06:02,  2.16s/it]Processing batches:  73%|███████▎  | 444/610 [12:05<05:19,  1.92s/it]Processing batches:  73%|███████▎  | 445/610 [12:08<05:28,  1.99s/it]Processing batches:  73%|███████▎  | 446/610 [12:20<09:55,  3.63s/it]Processing batches:  74%|███████▍  | 450/610 [12:20<05:09,  1.94s/it]Processing batches:  74%|███████▍  | 451/610 [12:20<04:26,  1.68s/it]Processing batches:  74%|███████▍  | 452/610 [12:21<03:47,  1.44s/it]Processing batches:  74%|███████▍  | 454/610 [12:23<03:41,  1.42s/it]Processing batches:  75%|███████▍  | 456/610 [12:28<04:27,  1.74s/it]Processing batches:  75%|███████▍  | 457/610 [12:33<05:42,  2.24s/it]Processing batches:  75%|███████▌  | 460/610 [12:37<04:49,  1.93s/it]Processing batches:  76%|███████▌  | 464/610 [12:51<06:13,  2.56s/it]Processing batches:  76%|███████▌  | 465/610 [12:51<05:34,  2.31s/it]Processing batches:  76%|███████▋  | 466/610 [12:52<04:44,  1.98s/it]Processing batches:  77%|███████▋  | 468/610 [12:54<03:57,  1.67s/it]Processing batches:  77%|███████▋  | 470/610 [12:55<03:14,  1.39s/it]Processing batches:  78%|███████▊  | 473/610 [12:56<02:02,  1.12it/s]Processing batches:  78%|███████▊  | 474/610 [12:57<02:03,  1.10it/s]Processing batches:  79%|███████▉  | 482/610 [12:57<00:47,  2.67it/s]Processing batches:  79%|███████▉  | 484/610 [12:59<00:56,  2.21it/s]Processing batches:  80%|████████  | 490/610 [13:10<02:04,  1.04s/it]Processing batches:  80%|████████  | 491/610 [13:12<02:15,  1.14s/it]Processing batches:  81%|████████  | 492/610 [13:17<03:11,  1.62s/it]Processing batches:  81%|████████  | 493/610 [13:20<03:30,  1.80s/it]Processing batches:  81%|████████  | 494/610 [13:22<03:29,  1.81s/it]Processing batches:  81%|████████  | 495/610 [13:32<06:37,  3.45s/it]Processing batches:  82%|████████▏ | 499/610 [13:34<03:31,  1.91s/it]Processing batches:  82%|████████▏ | 500/610 [13:35<03:11,  1.74s/it]Processing batches:  82%|████████▏ | 501/610 [13:39<04:05,  2.25s/it]Processing batches:  83%|████████▎ | 504/610 [13:39<02:16,  1.29s/it]Processing batches:  83%|████████▎ | 505/610 [13:45<03:27,  1.97s/it]Processing batches:  83%|████████▎ | 506/610 [13:47<03:39,  2.11s/it]Processing batches:  83%|████████▎ | 509/610 [13:50<02:44,  1.63s/it]Processing batches:  84%|████████▎ | 510/610 [13:51<02:27,  1.48s/it]Processing batches:  84%|████████▍ | 511/610 [13:53<02:39,  1.62s/it]Processing batches:  84%|████████▍ | 512/610 [14:01<04:56,  3.03s/it]Processing batches:  84%|████████▍ | 513/610 [14:02<03:49,  2.36s/it]Processing batches:  84%|████████▍ | 514/610 [14:04<03:42,  2.32s/it]Processing batches:  84%|████████▍ | 515/610 [14:04<02:44,  1.74s/it]Processing batches:  85%|████████▍ | 516/610 [14:04<02:11,  1.40s/it]Processing batches:  85%|████████▍ | 517/610 [14:05<01:48,  1.17s/it]Processing batches:  85%|████████▍ | 518/610 [14:05<01:22,  1.11it/s]Processing batches:  85%|████████▌ | 519/610 [14:08<01:56,  1.28s/it]Processing batches:  85%|████████▌ | 520/610 [14:08<01:25,  1.05it/s]Processing batches:  85%|████████▌ | 521/610 [14:17<05:15,  3.54s/it]Processing batches:  86%|████████▌ | 522/610 [14:18<03:46,  2.58s/it]Processing batches:  86%|████████▌ | 523/610 [14:18<02:45,  1.90s/it]Processing batches:  87%|████████▋ | 528/610 [14:19<00:59,  1.38it/s]Processing batches:  87%|████████▋ | 530/610 [14:19<00:42,  1.87it/s]Processing batches:  88%|████████▊ | 534/610 [14:19<00:25,  2.97it/s]Processing batches:  88%|████████▊ | 536/610 [14:19<00:20,  3.64it/s]Processing batches:  88%|████████▊ | 538/610 [14:20<00:17,  4.16it/s]Processing batches:  88%|████████▊ | 539/610 [14:22<00:38,  1.82it/s]Processing batches:  89%|████████▊ | 540/610 [14:27<01:30,  1.30s/it]Processing batches:  89%|████████▉ | 542/610 [14:30<01:32,  1.37s/it]Processing batches:  89%|████████▉ | 543/610 [14:38<03:05,  2.76s/it]Processing batches:  90%|████████▉ | 547/610 [14:41<01:44,  1.65s/it]Processing batches:  90%|████████▉ | 548/610 [14:42<01:35,  1.54s/it]Processing batches:  90%|█████████ | 549/610 [14:42<01:23,  1.36s/it]Processing batches:  90%|█████████ | 550/610 [14:46<01:49,  1.82s/it]Processing batches:  90%|█████████ | 551/610 [14:51<02:37,  2.68s/it]Processing batches:  91%|█████████ | 553/610 [14:53<01:49,  1.92s/it]Processing batches:  91%|█████████ | 554/610 [14:55<01:52,  2.01s/it]Processing batches:  91%|█████████ | 556/610 [14:56<01:13,  1.36s/it]Processing batches:  91%|█████████▏| 557/610 [15:01<01:51,  2.09s/it]Processing batches:  92%|█████████▏| 559/610 [15:03<01:33,  1.83s/it]Processing batches:  92%|█████████▏| 560/610 [15:13<02:51,  3.44s/it]Processing batches:  92%|█████████▏| 563/610 [15:14<01:30,  1.92s/it]Processing batches:  93%|█████████▎| 567/610 [15:20<01:13,  1.72s/it]Processing batches:  93%|█████████▎| 570/610 [15:30<01:34,  2.36s/it]Processing batches:  94%|█████████▍| 574/610 [15:31<00:54,  1.50s/it]Processing batches:  96%|█████████▌| 583/610 [15:31<00:18,  1.48it/s]Processing batches:  96%|█████████▋| 588/610 [15:32<00:11,  1.97it/s]Processing batches:  97%|█████████▋| 590/610 [15:37<00:15,  1.29it/s]Processing batches:  97%|█████████▋| 592/610 [15:37<00:12,  1.44it/s]Processing batches:  97%|█████████▋| 593/610 [15:39<00:13,  1.24it/s]Processing batches:  97%|█████████▋| 594/610 [15:39<00:11,  1.35it/s]Processing batches:  98%|█████████▊| 596/610 [15:40<00:09,  1.44it/s]Processing batches:  98%|█████████▊| 599/610 [15:41<00:05,  2.01it/s]Processing batches:  99%|█████████▉| 606/610 [15:42<00:01,  3.32it/s]Processing batches: 100%|█████████▉| 608/610 [15:42<00:00,  3.88it/s]Processing batches: 100%|██████████| 610/610 [15:42<00:00,  1.55s/it]
INFO:pdex._single_cell:Flattening results
INFO:pdex._single_cell:Closing shared memory pool
INFO:cell_eval._evaluator:Writing pred DE results to: hepg2_pred_de.csv
INFO:cell_eval._types._de:Checking DE data integrity... (real)
INFO:cell_eval._types._de:DE data integrity check complete. (real)
INFO:cell_eval._types._de:Checking DE data integrity... (pred)
INFO:cell_eval._types._de:DE data integrity check complete. (pred)
INFO:cell_eval._pipeline._runner:Computing metric 'overlap_at_N'
INFO:cell_eval._pipeline._runner:Computing metric 'overlap_at_50'
INFO:cell_eval._pipeline._runner:Computing metric 'overlap_at_100'
INFO:cell_eval._pipeline._runner:Computing metric 'overlap_at_200'
INFO:cell_eval._pipeline._runner:Computing metric 'overlap_at_500'
INFO:cell_eval._pipeline._runner:Computing metric 'precision_at_N'
INFO:cell_eval._pipeline._runner:Computing metric 'precision_at_50'
INFO:cell_eval._pipeline._runner:Computing metric 'precision_at_100'
INFO:cell_eval._pipeline._runner:Computing metric 'precision_at_200'
INFO:cell_eval._pipeline._runner:Computing metric 'precision_at_500'
INFO:cell_eval._pipeline._runner:Computing metric 'de_spearman_sig'
INFO:cell_eval._pipeline._runner:Computing metric 'de_direction_match'
INFO:cell_eval._pipeline._runner:Computing metric 'de_spearman_lfc_sig'
INFO:cell_eval._pipeline._runner:Computing metric 'de_sig_genes_recall'
INFO:cell_eval._pipeline._runner:Computing metric 'de_nsig_counts'
INFO:cell_eval._pipeline._runner:Computing metric 'pr_auc'
INFO:cell_eval._pipeline._runner:Computing metric 'roc_auc'
INFO:cell_eval._pipeline._runner:Computing metric 'pearson_delta'
INFO:cell_eval._types._anndata:Building pseudobulk embeddings for real anndata on: .X
INFO:cell_eval._types._anndata:Building pseudobulk embeddings for predicted anndata on: .X
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...:  43%|████▎     | 29/68 [00:00<00:00, 289.22it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 509.25it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'mse'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 1360.79it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'mae'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 1412.55it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'mse_delta'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 1124.95it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'mae_delta'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 1534.25it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'discrimination_score_l1'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 6726.56it/s]
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 6490.66it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'discrimination_score_l2'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 5836.27it/s]
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 6880.72it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'discrimination_score_cosine'
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 5923.42it/s]
Iterating over perturbations...:   0%|          | 0/68 [00:00<?, ?it/s]Iterating over perturbations...: 100%|██████████| 68/68 [00:00<00:00, 6040.98it/s]
INFO:cell_eval._evaluator:Writing perturbation level metrics to checkpoints/first_run/eval_last.ckpt/hepg2_results.csv
INFO:cell_eval._evaluator:Writing aggregate metrics to checkpoints/first_run/eval_last.ckpt/hepg2_agg_results.csv
